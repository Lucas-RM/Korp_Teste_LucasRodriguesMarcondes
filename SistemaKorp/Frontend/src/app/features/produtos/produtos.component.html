<div class="produtos-grid">
  <mat-card class="card-form">
    <mat-card-header>
      <mat-card-title>Novo Produto</mat-card-title>
    </mat-card-header>

    <mat-card-content>
      <form class="form" [formGroup]="form" (ngSubmit)="submit()">
        <mat-form-field appearance="outline">
          <mat-label>Código do Produto</mat-label>
          <input matInput formControlName="codigo" maxlength="50" />
          @if (form.controls.codigo.hasError('required')) {
            <mat-error>Código é obrigatório</mat-error>
          } @else if (form.controls.codigo.hasError('maxlength')) {
            <mat-error>Código deve ter no máximo 50 caracteres</mat-error>
          }
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Descrição</mat-label>
          <input matInput formControlName="descricao" maxlength="200" />
          @if (form.controls.descricao.hasError('required')) {
            <mat-error>Descrição é obrigatória</mat-error>
          } @else if (form.controls.descricao.hasError('maxlength')) {
            <mat-error>Descrição deve ter no máximo 200 caracteres</mat-error>
          }
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Saldo Inicial</mat-label>
          <input matInput type="number" formControlName="saldo" min="0" />
          @if (form.controls.saldo.hasError('required')) {
            <mat-error>Saldo é obrigatório</mat-error>
          } @else if (form.controls.saldo.hasError('min')) {
            <mat-error>Saldo não pode ser negativo</mat-error>
          }
        </mat-form-field>

        <button
          mat-raised-button
          color="primary"
          type="submit"
          [disabled]="isSubmitting()"
          class="submit"
        >
          @if (isSubmitting()) {
            <mat-spinner diameter="18" aria-label="Carregando"></mat-spinner>
          } @else {
            Cadastrar Produto
          }
        </button>
      </form>
    </mat-card-content>
  </mat-card>

  <mat-card class="card-list">
    <mat-card-header>
      <mat-card-title>Produtos Cadastrados</mat-card-title>
    </mat-card-header>

    <mat-card-content class="list-content">
      @if (isLoadingList()) {
        <mat-progress-bar mode="indeterminate"></mat-progress-bar>
      }

      @if (!isLoadingList() && dataSource.data.length === 0) {
        <div class="empty-state">
          <mat-icon aria-hidden="true">inventory_2</mat-icon>
          <div class="empty-title">Nenhum produto cadastrado</div>
        </div>
      } @else {
        <div class="table-wrapper">
          <table mat-table [dataSource]="dataSource" matSort class="mat-elevation-z0">
            <ng-container matColumnDef="codigo">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>Código</th>
              <td mat-cell *matCellDef="let row">{{ row.codigo }}</td>
            </ng-container>

            <ng-container matColumnDef="descricao">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>Descrição</th>
              <td mat-cell *matCellDef="let row">{{ row.descricao }}</td>
            </ng-container>

            <ng-container matColumnDef="saldo">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>Saldo</th>
              <td mat-cell *matCellDef="let row">{{ row.saldo | number: '1.2-2' }}</td>
            </ng-container>

            <ng-container matColumnDef="simularFalha">
              <th mat-header-cell *matHeaderCellDef>Simular Falha</th>
              <td mat-cell *matCellDef="let row">
                <mat-slide-toggle
                  [checked]="row.simularFalha"
                  [disabled]="isToggling(row.id)"
                  matTooltip="Ativar/desativar simulação de falha de estoque para este produto"
                  (change)="alternarSimularFalha(row, $event)"
                  aria-label="Alternar simulação de falha"
                />
              </td>
            </ng-container>

            <ng-container matColumnDef="criadoEm">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>Criado Em</th>
              <td mat-cell *matCellDef="let row">
                {{ row.criadoEm | date: 'dd/MM/yyyy HH:mm' }}
              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
          </table>

          <mat-paginator
            [pageSizeOptions]="[5, 10, 25]"
            [pageSize]="10"
            showFirstLastButtons
          />
        </div>
      }
    </mat-card-content>
  </mat-card>
</div>

